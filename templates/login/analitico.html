<!-- templates/analitico.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analise de Pesquisa</title>
  <!-- Google Fonts: Roboto -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="shortcut icon" href="{{ url_for('static', filename='/img/favicon.ico') }}" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
    rel="stylesheet"
  />

  <!-- CSS personalizado -->
  <link rel="stylesheet" href="{{ url_for('static', filename='analitico.css') }}" />
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <ul>
      <li><a href="{{ url_for('admin') }}">In√≠cio</a></li>
      <li><a href="{{ url_for('pesquisa') }}">Pesquisa</a></li>
      <li><a class="active" href="{{ url_for('analitico') }}">Anal√≠tico</a></li>
      <li><a href="{{ url_for('logout') }}">Sair</a></li>
    </ul>
  </nav>

  <!-- Conte√∫do principal -->
  <main class="container">
    <h1 class="page-title">Vis√£o Anal√≠tica</h1>

    <!-- Barra de controles -->
    <div class="controls">
      <input
        type="search"
        id="searchInput"
        placeholder="üîç Buscar pergunta..."
        aria-label="Buscar pergunta"
      />
      <select id="minResponses" aria-label="Filtrar pelo n√∫mero m√≠nimo de respostas">
        <option value="0">Todas as perguntas</option>
        <option value="5">‚â• 5 respostas</option>
        <option value="10">‚â• 10 respostas</option>
      </select>
      <button id="toggleView" title="Alternar visualiza√ß√£o" aria-label="Alternar visualiza√ß√£o">
        ‚ò∞
      </button>
    </div>

    {% if charts %}
      <!-- Lista de cards -->
      <div class="cards-grid">
        {% for c in charts %}
          <div class="question-card" data-count="{{ c.count }}">
            <div class="card-header">
              <div class="question-text">{{ c.question_text }}</div>
              <div class="meta">
                <span class="response-count">{{ c.count }} respostas</span>
                <button
                  class="copy-btn"
                  onclick="copyQuestion({{ loop.index0 }})"
                  title="Copiar pergunta"
                  aria-label="Copiar pergunta"
                >üìã</button>
              </div>
            </div>
            <div class="card-body">
              <img
                class="chart-img"
                src="data:image/png;base64,{{ c.img_b64 }}"
                alt="Gr√°fico da pergunta {{ loop.index }}"
              />
              <ul class="legend">
                {% for item in c.legend %}
                  <li class="legend-item" title="{{ item.label }}">
                    <span
                      class="dot"
                      style="background-color: {{ item.color }}"
                    ></span>
                    <span class="label">{{ item.label }}</span>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="no-data">Nenhum gr√°fico dispon√≠vel.</p>
    {% endif %}
  </main>

  <!-- Scripts de intera√ß√£o -->
  <script>
    function copyQuestion(idx) {
      const txt = document.querySelectorAll('.question-text')[idx].innerText;
      navigator.clipboard
        .writeText(txt)
        .then(() => alert('Pergunta copiada!'))
        .catch(() => alert('Falha ao copiar.'));
    }

    // Filtrar por n√∫mero m√≠nimo de respostas
    document.getElementById('minResponses').addEventListener('change', function (e) {
      const min = +e.target.value;
      document.querySelectorAll('.question-card').forEach(card => {
        card.style.display = +card.dataset.count >= min ? '' : 'none';
      });
    });

    // Buscar por texto na pergunta
    document.getElementById('searchInput').addEventListener('input', function (e) {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.question-card').forEach(card => {
        const text = card.querySelector('.question-text').innerText.toLowerCase();
        card.style.display = text.includes(term) ? '' : 'none';
      });
    });

    // Alternar visualiza√ß√£o (implementa√ß√£o futura)
    document.getElementById('toggleView').addEventListener('click', function () {
      document.querySelector('.cards-grid').classList.toggle('list-view');
    });
  </script>
</body>
</html>
